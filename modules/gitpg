#!/bin/sh
name="$(grep ^$(logname) /etc/passwd | cut -d: -f5 | cut -d, -f1)"
ki="$(tempfile)"
echo "Key-Type: RSA" > "$ki"
echo "Key-Length: 4096" >> "$ki"
echo "Subkey-Type: RSA" >> "$ki"
echo "Subkey-Length: 4096" >> "$ki"
echo "Name-Real: $name" >> "$ki"
echo "Name-Email: $1" >> "$ki"
echo "Name-Comment: git signingkey generated by the gitpg module of i3buntu" >> "$ki"
gpg --gen-key --batch "$ki"
rm -f "$ki"
git config --global credential.helper /usr/share/doc/git/contrib/credential/libsecret/git-credential-libsecret
git config --global user.signingkey "$(gpg --list-keys | grep -E '[0-9A-F]{40}' | sed 's/ //g')"
git config --global commit.gpgsign true
gpg -a --export > /home/$(logname)/.gitpg_pubkey
