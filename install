#!/bin/bash

###### Update packages and add ppas
add-apt-repository ppa:yubico/stable
add-apt-repository ppa:nextcloud-devs/client
apt update
apt upgrade -y

###### Install main apps, drivers and dependencies
echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | debconf-set-selections
apt install -y ubuntu-drivers-common openssh-client curl gcc g++\
	libstartup-notification0 clang make autoconf automake\
	x11-xserver-utils arandr python-gconf libpng-dev libusb-dev\
	lxappearance vim gnome-system-tools network-manager\
	wireless-tools overlay-scrollbar overlay-scrollbar-gtk2\
	exfat-fuse exfat-utils gstreamer1.0-pulseaudio\
	transmission-gtk pulseaudio-utils feh gnome-terminal i3 scrot\
	xserver-xorg-video-intel acpi-support apport-gtk\
	foomatic-db-compressed-ppds evince evince-common\
	libssh-4 libnm-glib-vpn1 dmz-cursor-theme libwayland-cursor0\
	libxcursor1 xcursor-themes mousetweaks laptop-detect\
	usb-creator-common usb-creator-gtk gnome-power-manager\
	openjdk-8-jdk apt-transport-https fonts-hack-ttf
snap install vscode --classic
snap install github-desktop --beta --classic
curl -L -o pmp.deb https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
dpkg -i pmp.deb
rm -f pmp.deb
add-apt-repository universe
dpkg --add-architecture i386
curl -L -o - https://github.com/chrissxYT/winstallhq/raw/master/winstall.hq | sh
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
echo "deb https://download.mono-project.com/repo/ubuntu stable-bionic main" | tee /etc/apt/sources.list.d/mono-official-stable.list
apt update
apt install -y dotnet-sdk-2.2 zsh htop tmux dosbox blender w3m\
	progress ncdu icdiff kdenlive mplayer obs-studio gimp\
	audacity tor lm-sensors wireshark vifm sox wifi-radar\
	libudev-dev cmake fonts-powerline breeze help2man\
	libcurl4-openssl-dev libssl-dev flex bison libelf-dev gcc-avr\
	binutils-avr avr-libc yubikey-manager-qt nextcloud-client\
	yubikey-personalization-gui yubioath-desktop thunderbird\
	samba mono-complete p7zip-full iotop dstat atop libimlib2-dev\
	libheif-dev\
	lzma net-tools libxft-dev libgtk2.0-dev libgtk-3-dev\
	webkit2gtk-4.0 python-pip python3-pip youtube-dl golang rustc
if [[ $1 -eq "o" ]]
then
	###### Get and install Opera
	curl -L -o op.deb "https://download1.operacdn.com/pub/opera/desktop/60.0.3255.109/linux/opera-stable_60.0.3255.109_amd64.deb"
	dpkg -i op.deb
	rm -f op.deb
else
	if [[ $1 -eq "f" ]]
	then
		apt install firefox
	fi
fi
# just to make sure icons arent corrupted all the time (happend on my machine)
apt remove -y breeze-cursor-theme

###### Get and install imlib2-heic (HEIC for feh)
git clone https://github.com/vi/imlib2-heic.git im2heic
cd im2heic
make
make install
cd ..
rm -rfim2heic

###### Get and install yEd
curl -L -o yed.sh "https://www.yworks.com/resources/yed/demo/yEd-3.19_with-JRE11_64-bit_setup.sh"
chmod +x yed.sh
./yed.sh
rm yed.sh

###### Get and install fzf
curl -L -o fzf.deb http://launchpadlibrarian.net/405439988/fzf_0.17.5-2_amd64.deb
dpkg -i fzf.deb
rm -f fzf.deb

###### Get and install sane-sent
curl -L -o ss.zip https://github.com/chrissxYT/sane-sent/archive/c001.zip
unzip ss.zip
cd sane-sent-c001
make install
cd ..
rm -rf sane-sent-c001
rm -f ss.zip

###### Get and install the Arduino IDE
curl -L -o ad.tar.xz "https://downloads.arduino.cc/arduino-1.8.8-linux64.tar.xz"
tar xJf ad.tar.xz
mv arduino-1.8.8 /usr/bin/
cd /usr/bin/arduino-1.8.8
./arduino-linux-setup.sh $USER
popd
rm -f ad.tar.xz

###### Get and install the Teensy loader
curl -L -o /etc/udev/rules.d/49-teensy.rules "https://www.pjrc.com/teensy/49-teensy.rules"
curl -L -o t.tar.gz "https://www.pjrc.com/teensy/teensy_linux64.tar.gz"
tar xzf t.tar.gz
mv teensy /bin
rm -f t.tar.gz libpng12.so.0 libusb-0.1.so.4

###### Get and install Teensyduino
curl -L -o td "https://www.pjrc.com/teensy/td_145/TeensyduinoInstall.linux64"
chmod +x td
./td

###### Get and install TeamViewer
curl -L -o tv.deb 'https://download.teamviewer.com/download/linux/teamviewer_amd64.deb'
dpkg -i tv.deb
rm -f tv.deb

###### Get and install ybacklight
curl -L -o yb.sh "https://github.com/chrissxYT/ybacklight/raw/master/installer.sh"
chmod +x yb.sh
./yb.sh
rm -f yb.sh

###### Get and install FlashPrint
curl -L -o fp.deb 'http://www.sz3dp.com/upfile/2018/12/03/20181203162713_662.deb'
dpkg -i fp.deb
rm -f fp.deb

###### Get and install playerctl
curl -L -o pc.deb 'https://github.com/acrisci/playerctl/releases/download/v2.0.1/playerctl-2.0.1_amd64.deb'
dpkg -i pc.deb
rm -f pc.deb

###### Get and install the fixed version of neofetch
git clone https://github.com/chrissxYT/neofetch.git nf
cd nf
make install
cd ..
rm -rf nf

###### Get and install EOS
mkdir tmp_eos_stuff
cd tmp_eos_stuff
curl -L -o eos.zip "https://www.pabst-software.de/lib/exe/fetch.php?media=programme:eos:eos.zip"
unzip eos.zip
cp -f EOS.exe /usr/bin/eos.exe
cd ..
rm -rf tmp_eos_stuff

###### Install helper "scripts"
cp -f tools/ghk /usr/bin/ghk
cp -f tools/ghp /usr/bin/ghp
cp -f tools/update /usr/bin/update
cp -f tools/mnt /bin/mnt
cp -f tools/unmount /bin/unmount
cp -f tools/sd /sbin/sd
cp -f tools/netsh /usr/bin/netsh
cp -f tools/lock /usr/bin/lock
cp -f tools/eos /usr/bin/eos
if [[ ! -f ~/.ghk.enc ]]
then
	vim ghk.txt
	openssl aes-256-cbc -a -in ghk.txt -out ~/.ghk.enc
	rm -f ghk.txt
fi

###### Remove bloatware
apt remove -y gedit gnome-user-docs gnome-user-guide
snap remove gnome-calculator

###### Install resources
cp -rf res ~/.i3buntu

###### Change the distro name
echo "i3buntu 18.04+ \n \l" > /etc/issue
echo -n "i3buntu 18.04+" > /etc/issue.net
cp -f configs/os-release /etc/os-release
cp -f configs/lsbr /etc/lsb-release

###### Finish up everything
apt --fix-broken install -y
apt autoremove -y

# give the user rights to all of their home directory
chown -R $USER:$USER ~
